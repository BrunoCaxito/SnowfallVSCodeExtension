{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "Snowfall Script",
	"scopeName": "source.sf",

	"patterns": [
		{
			"include": "#metadata"
		},

		{
			"include": "#dialog"
		},
		{
			"include": "#label"
		},
		{
			"include": "#goto"
		},
		{
			"include": "#options"
		},
		{
			"include": "#command"
		},
		{
			"include": "#comment"
		}
	],

	"repository": {
		"metadata": {
			"name": "metadata.sf",
			"comment": "instruction metadata",
			"match": "\\|.*",
			"captures": {
				"0": {
					"patterns": [
						{
							"patterns": [
								{
									"name": "metadata.expressions.sf",
									"comment": "Expression",
									"match": "(\\|)(.*?)(?=(\\||$))",
									"captures": {
										"1": {
											"name": "concat.sf"
										},
										"2": {
											"patterns": [
												{
													"name": "metadata.expressions.sf",
													"comment": "Expression",
													"match": "(\\#\\w+)|(->\\s\\w+)|((.*?)(=|!|(?<!-)>|<|\\+|-(?!>)|\\*|\/)(.*))",
													"captures": {
														"0": {
															"name": "function.sf"
														},
														"1": {
															"name": "tag.sf"
														},
														"2": {
															"name": "goto.sf"
														},
														"3": {
															"name": "command.sf"
														},
														"4": {
															"name": "lvalue.sf"
														},
														"5": {
															"name": "operator.sf"
														},
														"6": {
															"name": "rvalue.sf",
															"patterns": [
																{
																	"include": "#richtext"
																},
																{
																	"name": "keyword.sf",
																	"match": "(?<!\\w)(true|false|on|off)(?!\\w)"
																},

																{
																	"name": "number.sf",
																	"match": "(?<!\\w)([\\d]+)(?!\\w)"
																},

																{
																	"name": "string.sf",
																	"match": "\\w+"
																},

																{
																	"name": "entity.name.variable.sf",
																	"match": "{.*}"
																}
															]
														}
													}
												}
											]
										}
									}
								}
							]
						}
					]
				}
			}
		},

		"richtext": {
			"name": "entity.name.tag.sf",
			"match": "<(\\w*).*?>"
		},

		"dialog": {
			"patterns": [
				{
					"name": "keyword.dialog.sf",
					"match": "^(\\-\\ )(.*?)(?=\\||$)(.*$)",
					"captures": {
						"1": {
							"name": "keyword.dialog.sign.sf"
						},

						"2": {
							"name": "keyword.dialog.text.sf"
						},

						"3": {
							"name": "keyword.dialog.metadata.sf",
							"patterns": [
								{
									"include": "#metadata"
								}
							]
						}
					}
				},
				{
					"name": "string.dialog.sf",
					"match": "^(\\t)(.*$)",
					"captures": {
						"1": {
							"name": "string.dialog.tag.sf"
						},

						"2": {
							"name": "string.dialog.text.sf",

							"patterns": [
								{
									"include": "#richtext"
								}
							]
						}
					}
				}
			]
		},

		"label": {
			"name": "entity.name.namespace.label.sf",
			"match": "^(@\\ )(.*?)(?=\\ \\||$)(.*$)",
			"captures": {
				"1": {
					"name": "entity.name.namespace.label.sign.sf"
				},

				"2": {
					"name": "entity.name.namespace.label.text.sf"
				},

				"3": {
					"name": "entity.name.namespace.metadata.label",
					"patterns": [
						{
							"include": "#metadata"
						}
					]
				}
			}
		},

		"goto": {
			"name": "variable.other.event.goto.sf",
			"match": "^(\\->\\ )(.*?)(?=\\||$)(.*$)",
			"captures": {
				"1": {
					"name": "variable.other.event.goto.sign.sf"
				},

				"2": {
					"name": "variable.other.event.goto.label.sf"
				},

				"3": {
					"name": "variable.other.event.goto.metadata.sf",
					"patterns": [
						{
							"include": "#metadata"
						}
					]
				}
			}
		},

		"options": {
			"name": "entity.name.type.enum.option.sf",
			"match": "^(\\*\\ )(.*?)(?=\\||$)(.*$)",
			"captures": {
				"1": {
					"name": "entity.name.type.enum.option.sign.sf"
				},

				"2": {
					"name": "entity.name.type.enum.option.text.sf",
					"patterns": [
						{
							"include": "#richtext"
						}
					]
				},

				"3": {
					"name": "entity.name.type.enum.option.metadata.sf",
					"patterns": [
						{
							"include": "#metadata"
						}
					]
				}
			}
		},

		"command": {
			"name": "entity.name.function.command.sf",
			"match": "^(\\$\\ )(.*?)(?=\\||$)(.*$)",
			"captures": {
				"1": {
					"name": "entity.name.function.command.sign.sf"
				},

				"2": {
					"name": "entity.name.function.command.instruction.sf"
				},

				"3": {
					"name": "entity.name.function.command.metadata.sf",
					"patterns": [
						{
							"include": "#metadata"
						}
					]
				}
			}
		},

		"comment": {
			"patterns": [
				{
					"name": "comment.title.sf",
					"match": "(SCENE)[ -Z]+"
				},

				{
					"name": "comment.header.sf",
					"match": "[0-9A-Z\\s\\.\\-\\'\\,]{12,}"
				},

				{
					"name": "comment.sf",
					"match": "^(?!(\\-|\\t|@|\\*|\\$))(.*)"
				}
			]
		}
	}
}
